<!DOCTYPE html>
<html lang="uk">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>MindAR + Three.js Сатурн</title>
    <style>
      html, body {
        margin: 0;
        width: 100%;
        height: 100%;
        overflow: hidden;
      }
      #loading {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        color: white;
        font-family: Arial, sans-serif;
        font-size: 24px;
        background: rgba(0,0,0,0.7);
        padding: 20px;
        border-radius: 10px;
      }
      #error {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        color: red;
        font-family: Arial, sans-serif;
        font-size: 24px;
        background: rgba(0,0,0,0.7);
        padding: 20px;
        border-radius: 10px;
        display: none;
      }
    </style>
    <script type="importmap">
    {
      "imports": {
        "three": "https://cdn.jsdelivr.net/npm/three@0.160.0/build/three.module.js",
        "three/addons/": "https://cdn.jsdelivr.net/npm/three@0.160.0/examples/jsm/",
        "mindar-image-three":"https://cdn.jsdelivr.net/npm/mind-ar@1.2.5/dist/mindar-image-three.prod.js"
      }
    }
    </script>
  </head>
  <body>
    <div id="loading">Завантаження...</div>
    <div id="error"></div>
    <script type="module">
      import * as THREE from 'three';
      import { MindARThree } from 'mindar-image-three';

      document.addEventListener("DOMContentLoaded", () => {
        const start = async () => {
          try {
            const loadingElement = document.getElementById('loading');
            const errorElement = document.getElementById('error');
            
            loadingElement.textContent = "Завантаження текстури...";
            
            // Текстура Сатурна
            const textureLoader = new THREE.TextureLoader();
            const saturnTexture = await new Promise((resolve, reject) => {
              textureLoader.load(
                "https://raw.githubusercontent.com/mrdoob/three.js/dev/examples/textures/planets/saturnringcolor.png", 
                resolve, 
                undefined, 
                reject
              );
            });
            
            loadingElement.textContent = "Ініціалізація MindAR...";
            
            const mindarThree = new MindARThree({
              container: document.body,
              imageTargetSrc: "Week8.mind"
            });

            const { renderer, scene, camera } = mindarThree;
            renderer.outputColorSpace = THREE.SRGBColorSpace;

            const anchor = mindarThree.addAnchor(0);

            // Модель Сатурна
            const saturn = new THREE.Mesh(
              new THREE.SphereGeometry(0.6, 64, 64),
              new THREE.MeshStandardMaterial({ map: saturnTexture })
            );
            saturn.rotation.x = THREE.MathUtils.degToRad(27);

            // Кільця Сатурна
            const ringMaterial = new THREE.MeshBasicMaterial({
              color: 0xccccff,
              side: THREE.DoubleSide,
              transparent: true,
              opacity: 0.5,
            });
            const ring = new THREE.Mesh(
              new THREE.RingGeometry(0.75, 1.35, 128),
              ringMaterial
            );
            ring.rotation.x = -Math.PI / 2;

            // Група Сатурн + кільця
            const saturnGroup = new THREE.Group();
            saturnGroup.add(saturn);
            saturnGroup.add(ring);

            anchor.group.add(saturnGroup);

            // Освітлення
            const light = new THREE.DirectionalLight(0xffffff, 1.5);
            light.position.set(5, 5, 5);
            anchor.group.add(light);
            scene.add(new THREE.AmbientLight(0xffffff, 0.5));

            loadingElement.textContent = "Запуск AR...";
            
            await mindarThree.start();
            loadingElement.style.display = "none";

            renderer.setAnimationLoop(() => {
              saturn.rotation.y += 0.005;
              saturnGroup.rotation.y += 0.001;
              renderer.render(scene, camera);
            });
          } catch (error) {
            console.error("Помилка:", error);
            document.getElementById('loading').style.display = "none";
            const errorElement = document.getElementById('error');
            errorElement.style.display = "block";
            errorElement.textContent = `Помилка: ${error.message}`;
          }
        };

        start();
      });
    </script>
  </body>
</html>