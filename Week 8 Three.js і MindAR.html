<!DOCTYPE html>
<html lang="uk">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>MindAR + Three.js Сатурн</title>
    <style>
      html, body {
        margin: 0;
        width: 100%;
        height: 100%;
        overflow: hidden;
        background-color: transparent;
      }
      #loading {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        color: black;
        font-family: Arial, sans-serif;
        font-size: 24px;
        background: rgba(255,255,255,0.8);
        padding: 20px;
        border-radius: 10px;
        z-index: 10;
      }
      #error {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        color: red;
        font-family: Arial, sans-serif;
        font-size: 24px;
        background: rgba(255,255,255,0.8);
        padding: 20px;
        border-radius: 10px;
        display: none;
        z-index: 10;
      }
      canvas {
        position: fixed;
        top: 0; left: 0;
        width: 100%;
        height: 100%;
        display: block;
      }
    </style>
    <script type="importmap">
    {
      "imports": {
        "three": "https://cdn.jsdelivr.net/npm/three@0.160.0/build/three.module.js",
        "mindar-image-three":"https://cdn.jsdelivr.net/npm/mind-ar@1.2.5/dist/mindar-image-three.prod.js"
      }
    }
    </script>
  </head>
  <body>
    <div id="loading">Завантаження...</div>
    <div id="error"></div>
    <script type="module">
      import * as THREE from 'three';
      import { MindARThree } from 'mindar-image-three';

      document.addEventListener("DOMContentLoaded", () => {
        const start = async () => {
          try {
            const loadingElement = document.getElementById('loading');
            const errorElement = document.getElementById('error');

            loadingElement.textContent = "Завантаження текстури...";

            const textureLoader = new THREE.TextureLoader();
            const saturnTexture = await new Promise((resolve, reject) => {
              textureLoader.load(
                "textures/2k_saturn.jpg",
                texture => resolve(texture),
                undefined,
                err => reject(err)
              );
            });

            loadingElement.textContent = "Ініціалізація MindAR...";

            const mindarThree = new MindARThree({
              container: document.body,
              imageTargetSrc: "Week8.mind"
            });

            const { renderer, scene, camera } = mindarThree;
            renderer.outputColorSpace = THREE.SRGBColorSpace;

            // Прозорий фон (щоб була камера)
            renderer.setClearColor(0x000000, 0);
            renderer.setClearAlpha(0);

            const anchor = mindarThree.addAnchor(0);

            // Модель Сатурна
            const saturn = new THREE.Mesh(
              new THREE.SphereGeometry(0.6, 64, 64),
              new THREE.MeshStandardMaterial({ map: saturnTexture })
            );
            saturn.rotation.x = THREE.MathUtils.degToRad(27);
            anchor.group.add(saturn);

            // Кільця Сатурна без текстури, напівпрозорі
            const ringGeometry = new THREE.RingGeometry(0.7, 1.0, 64);
            const ringMaterial = new THREE.MeshBasicMaterial({
              color: 0xcccccc,
              side: THREE.DoubleSide,
              transparent: true,
              opacity: 0.4
            });
            const rings = new THREE.Mesh(ringGeometry, ringMaterial);
            rings.rotation.x = THREE.MathUtils.degToRad(27);
            // Без повороту по Y, щоб кільця не перекошувались
            anchor.group.add(rings);

            // Освітлення
            const directionalLight = new THREE.DirectionalLight(0xffffff, 1.5);
            directionalLight.position.set(5, 5, 5);
            anchor.group.add(directionalLight);
            scene.add(new THREE.AmbientLight(0xffffff, 0.8));

            loadingElement.textContent = "Запуск AR...";

            await mindarThree.start();
            loadingElement.style.display = "none";

            renderer.setAnimationLoop(() => {
              saturn.rotation.y += 0.005;
              rings.rotation.z += 0.002;
              renderer.render(scene, camera);
            });
          } catch (error) {
            console.error("Помилка:", error);
            document.getElementById('loading').style.display = "none";
            const errorElement = document.getElementById('error');
            errorElement.style.display = "block";
            errorElement.textContent = `Помилка: ${error.message}`;
          }
        };

        start();
      });
    </script>
  </body>
</html>
